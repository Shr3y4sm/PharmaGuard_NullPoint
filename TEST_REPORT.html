<!doctype html>
<html>
  <head>
    <title>PharmaGuard - Test Results</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .success {
        color: #28a745;
        font-weight: bold;
      }
      .warning {
        color: #ffc107;
      }
      .error {
        color: #dc3545;
      }
      .section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
      }
      h2 {
        color: #555;
        border-bottom: 2px solid #007bff;
        padding-bottom: 10px;
      }
      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
      }
      .check {
        color: #28a745;
      }
      .bonus {
        color: #17a2b8;
      }
    </style>
  </head>
  <body>
    <h1>✅ PharmaGuard - Validation Report</h1>

    <div class="section">
      <h2>1. JSON Schema Compliance</h2>
      <p class="success">✓ All required fields present</p>
      <ul>
        <li class="check">✓ patient_id</li>
        <li class="check">✓ drug</li>
        <li class="check">✓ timestamp</li>
        <li class="check">
          ✓ risk_assessment (risk_label, confidence_score, severity)
        </li>
        <li class="check">
          ✓ pharmacogenomic_profile (primary_gene, diplotype, phenotype,
          detected_variants)
        </li>
        <li class="check">
          ✓ clinical_recommendation (dosage_adjustment, monitoring,
          alternative_drugs, urgency)
        </li>
        <li class="check">
          ✓ llm_generated_explanation (summary, mechanism, evidence_basis,
          interaction_notes)
        </li>
        <li class="check">
          ✓ quality_metrics (vcf_parsing_success, variant_count,
          data_completeness)
        </li>
        <li class="bonus">+ guideline_url (bonus field with CPIC citations)</li>
      </ul>
    </div>

    <div class="section">
      <h2>2. Frontend Display Issues - FIXED</h2>
      <p class="success">
        ✓ JavaScript updated to read 'data.analyses' instead of 'data.responses'
      </p>
      <p><strong>Changed in script.js line 171:</strong></p>
      <pre>
if (data.analyses && data.analyses.length > 0) {
    const allResponses = data.analyses;</pre
      >
    </div>

    <div class="section">
      <h2>3. Tab Content Verification</h2>
      <h3>Tab 0: Pharmacogenomic Profile</h3>
      <ul>
        <li class="check">✓ Primary Gene: CYP2D6</li>
        <li class="check">✓ Diplotype: *1/*1</li>
        <li class="check">✓ Phenotype: NM</li>
        <li class="check">✓ Detected Variants: 2 variants</li>
        <li class="bonus">
          + Guideline Citation:
          https://cpicpgx.org/guidelines/guideline-for-codeine-and-cyp2d6/
        </li>
      </ul>

      <h3>Tab 1: Clinical Recommendation</h3>
      <ul>
        <li class="check">✓ Dosage Adjustment</li>
        <li class="check">✓ Monitoring</li>
        <li class="check">✓ Alternative Drugs</li>
        <li class="check">✓ Urgency</li>
      </ul>

      <h3>Tab 2: Clinical Explanation</h3>
      <ul>
        <li class="check">✓ Summary</li>
        <li class="check">✓ Mechanism</li>
        <li class="check">✓ Evidence Basis</li>
        <li class="check">✓ Interaction Notes (3 items)</li>
      </ul>
    </div>

    <div class="section">
      <h2>4. Sample API Response</h2>
      <p><strong>Endpoint:</strong> POST /api/analysis</p>
      <pre>
{
  "total_analyses": 1,
  "analyses": [
    {
      "patient_id": "PATIENT_6A286E00",
      "drug": "CODEINE",
      "timestamp": "2026-02-19T20:03:55.058396Z",
      "risk_assessment": {
        "risk_label": "Safe",
        "confidence_score": 0.95,
        "severity": "none"
      },
      "pharmacogenomic_profile": {
        "primary_gene": "CYP2D6",
        "diplotype": "*1/*1",
        "phenotype": "NM",
        "detected_variants": [
          {"rsid": "rs1065852", "star": "*1"},
          {"rsid": "rs28371725", "star": "*1"}
        ]
      },
      "clinical_recommendation": {
        "dosage_adjustment": "Consult healthcare provider...",
        "monitoring": "Standard monitoring recommended",
        "alternative_drugs": [],
        "urgency": "routine"
      },
      "llm_generated_explanation": {
        "summary": "Your genetic profile has been analyzed...",
        "mechanism": "Your body's ability to process...",
        "evidence_basis": "Based on published clinical guidelines...",
        "interaction_notes": [
          "Always inform your doctor...",
          "Discuss any medication changes...",
          "Report any unusual side effects..."
        ]
      },
      "quality_metrics": {
        "vcf_parsing_success": true,
        "variant_count": 2,
        "data_completeness": "high"
      },
      "guideline_url": "https://cpicpgx.org/guidelines/guideline-for-codeine-and-cyp2d6/"
    }
  ]
}</pre
      >
    </div>

    <div class="section">
      <h2>5. Testing Instructions</h2>
      <ol>
        <li>
          Open browser to
          <a href="http://localhost:5000" target="_blank"
            >http://localhost:5000</a
          >
        </li>
        <li>Upload VCF file: <code>data/test_patient.vcf</code></li>
        <li>Select or enter drug: <code>CODEINE</code></li>
        <li>Click "Analyse Drug Risk"</li>
        <li>
          Verify:
          <ul>
            <li>Results header shows risk assessment</li>
            <li>Tab 0 shows pharmacogenomic profile with guideline link</li>
            <li>Tab 1 shows clinical recommendations</li>
            <li>Tab 2 shows LLM explanation</li>
            <li>JSON panel shows properly formatted output</li>
          </ul>
        </li>
      </ol>
    </div>

    <div class="section success">
      <h2>✅ Summary</h2>
      <ul>
        <li>
          <strong>JSON Schema:</strong> 100% compliant with all required fields
        </li>
        <li>
          <strong>Frontend Bug:</strong> FIXED (data.responses → data.analyses)
        </li>
        <li>
          <strong>Tab Display:</strong> All data available and ready for display
        </li>
        <li>
          <strong>Guideline Citations:</strong> Working and displayed in Tab 0
        </li>
        <li><strong>Status:</strong> Ready for testing in browser</li>
      </ul>
    </div>
  </body>
</html>
